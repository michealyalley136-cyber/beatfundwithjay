{% extends "base.html" %}
{% block title %}Admin - Dispute #{{ dispute.id }}{% endblock %}

{% block content %}
<div class="page" style="max-width:980px;margin:0 auto;padding:24px 16px;">
  <div class="card">
    <h2 style="margin-top:0;">Dispute #{{ dispute.id }} - Booking #{{ dispute.booking_id }}</h2>
    <p><strong>Opened by:</strong> @{{ dispute.opened_by.username }}</p>
    <p><strong>Reason:</strong> {{ dispute.reason }}</p>
    <p><strong>Status:</strong> {{ dispute.status|replace('_',' ')|title }}</p>

    <form method="POST" style="margin-top:12px;">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      <label style="display:block;font-weight:600;">Update status</label>
      <select name="status" style="padding:8px;border-radius:8px;border:1px solid #ddd;">
        {% for s in DISPUTE_STATUSES %}
          <option value="{{ s }}" {% if dispute.status == s %}selected{% endif %}>{{ s|replace('_',' ')|title }}</option>
        {% endfor %}
      </select>

      <label style="display:block;font-weight:600;margin-top:10px;">Reply</label>
      <textarea name="body" rows="4" maxlength="2000"
                style="width:100%;padding:10px;border-radius:8px;border:1px solid #ddd;"></textarea>
      <div style="margin-top:8px;">
        <button type="submit" class="btn btn-primary">Save</button>
        <a href="{{ url_for('admin_disputes') }}" class="btn btn-secondary">Back</a>
      </div>
    </form>
  </div>

  <div class="card" style="margin-top:16px;">
    <h3 style="margin-top:0;">Thread</h3>
    {% if messages %}
      {% for m in messages %}
        <div style="border-top:1px solid #eee;padding-top:8px;margin-top:8px;">
          <div style="font-size:12px;color:#6b7280;">
            @{{ m.author.username }} - {{ m.created_at.strftime('%Y-%m-%d %H:%M') }}
          </div>
          <div style="margin-top:4px;white-space:pre-line;">{{ m.body }}</div>
        </div>
      {% endfor %}
    {% else %}
      <p class="muted">No messages yet.</p>
    {% endif %}
  </div>
</div>
{% endblock %}
