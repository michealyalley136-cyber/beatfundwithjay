{% extends "base.html" %}
{% block title %}Funder Dashboard · BeatFund{% endblock %}

{% block extra_head %}
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  .bf-funder { max-width: 1200px; margin: 0 auto; padding: 16px; }
  .bf-hero { display:flex; gap:14px; align-items:center; justify-content:space-between; flex-wrap:wrap; margin-bottom: 20px; }
  .bf-hero-left { display:flex; gap:12px; align-items:center; min-width: 260px; }
  .bf-avatar { width: 56px; height: 56px; border-radius: 16px; object-fit: cover; border: 1px solid rgba(255,255,255,.12); }
  .bf-title { margin:0; font-size: 1.35rem; line-height: 1.2; }
  .bf-sub { margin:4px 0 0; opacity:.8; font-size: .95rem; }
  .bf-actions { display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:flex-end; }

  .bf-grid { display:grid; grid-template-columns: repeat(12, 1fr); gap: 14px; margin-top: 14px; }
  .bf-card { border: 1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.06); border-radius: 18px; padding: 16px; }
  .bf-card h3 { margin:0 0 12px; font-size: 1.1rem; font-weight: 700; }
  .bf-kpis { display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; }
  .bf-kpi { padding: 14px; border-radius: 16px; border: 1px solid rgba(255,255,255,.10); background: rgba(255,255,255,.05); }
  .bf-kpi .label { opacity:.75; font-size: .9rem; margin-bottom: 6px; }
  .bf-kpi .value { font-size: 1.5rem; font-weight: 800; line-height: 1.2; }
  .bf-kpi .hint { opacity:.7; font-size: .85rem; margin-top: 6px; }

  .bf-btn {
    display:inline-flex; align-items:center; justify-content:center;
    padding: 12px 16px; border-radius: 14px;
    border: 1px solid rgba(255,255,255,.12);
    background: rgba(255,255,255,.08);
    color: inherit;
    text-decoration:none;
    font-weight: 600;
    min-height: 44px;
    transition: all 0.2s ease;
  }
  .bf-btn:hover { background: rgba(255,255,255,.12); transform: translateY(-1px); }
  .bf-btn.primary { background: linear-gradient(135deg, rgba(251,191,36,.4), rgba(245,158,11,.3)); border-color: rgba(251,191,36,.5); }
  .bf-btn.primary:hover { background: linear-gradient(135deg, rgba(251,191,36,.5), rgba(245,158,11,.4)); }
  .bf-btn.block { width: 100%; }

  .bf-list { display:flex; flex-direction:column; gap:10px; }
  .bf-row { display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap; padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,.08); background: rgba(0,0,0,.2); }
  .bf-row .left { min-width: 0; flex: 1; }
  .bf-row .title { font-weight: 700; font-size: 1rem; }
  .bf-row .meta { opacity:.75; font-size:.9rem; margin-top: 4px; }
  .bf-chip {
    display:inline-flex; align-items:center;
    padding: 6px 12px; border-radius: 999px;
    border: 1px solid rgba(255,255,255,.12);
    background: rgba(255,255,255,.06);
    font-size: .85rem; opacity:.9;
  }

  .span-12 { grid-column: span 12; }
  .span-8 { grid-column: span 12; }
  .span-4 { grid-column: span 12; }
  .span-6 { grid-column: span 12; }

  @media (min-width: 900px){
    .span-8 { grid-column: span 8; }
    .span-4 { grid-column: span 4; }
    .span-6 { grid-column: span 6; }
  }
</style>
{% endblock %}

{% block content %}
<div class="bf-funder">

  <div class="bf-hero">
    <div class="bf-hero-left">
      <img class="bf-avatar" src="{{ current_user.avatar_url }}" alt="avatar">
      <div>
        <h1 class="bf-title">Funder Dashboard</h1>
        <p class="bf-sub">@{{ current_user.username }} · Discover & invest in opportunities</p>
      </div>
    </div>

    <div class="bf-actions">
      <a class="bf-btn primary" href="{{ url_for('opportunities') }}">Opportunities</a>
      <a class="bf-btn" href="{{ url_for('wallet_home') }}">Wallet</a>
      <a class="bf-btn" href="{{ url_for('producer_catalog_index') }}">Producers</a>
      <a class="bf-btn" href="{{ url_for('bookme_search') }}">Providers</a>
    </div>
  </div>

  <div class="bf-grid">

    <!-- Key Metrics -->
    <div class="bf-card span-12">
      <h3>Investment Portfolio Overview</h3>
      <div class="bf-kpis">
        <div class="bf-kpi">
          <div class="label">Wallet Balance</div>
          <div class="value">${{ '%.2f'|format(balance or 0) }}</div>
          <div class="hint">Available capital</div>
        </div>
        <div class="bf-kpi">
          <div class="label">Beat Purchases</div>
          <div class="value">{{ purchases_count }}</div>
          <div class="hint">Beats acquired</div>
        </div>
        <div class="bf-kpi">
          <div class="label">Transactions</div>
          <div class="value">{{ txns|length if txns else 0 }}</div>
          <div class="hint">Recent activity</div>
        </div>
        <div class="bf-kpi">
          <div class="label">Opportunities</div>
          <div class="value">—</div>
          <div class="hint">Explore available</div>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="bf-card span-4">
      <h3>Quick Actions</h3>
      <div class="bf-list">
        <a class="bf-btn block primary" href="{{ url_for('opportunities') }}">
          Browse Opportunities
        </a>
        <a class="bf-btn block" href="{{ url_for('producer_catalog_index') }}">
          Find Producers
        </a>
        <a class="bf-btn block" href="{{ url_for('bookme_search') }}">
          Discover Providers
        </a>
        <a class="bf-btn block" href="{{ url_for('market_index') }}">
          Marketplace
        </a>
        <a class="bf-btn block" href="{{ url_for('wallet_home') }}">
          Fund Wallet
        </a>
        <a class="bf-btn block" href="{{ url_for('my_tickets') }}">
          Support Tickets
        </a>
      </div>
    </div>

    <!-- Opportunities & Investments -->
    <div class="bf-card span-8">
      <h3>Investment Opportunities</h3>
      <div style="padding: 12px 0;">
        <p style="opacity:.8; margin-bottom: 16px;">
          Discover and invest in creative projects, producers, and opportunities in the music industry.
        </p>
        <div class="bf-list">
          <div class="bf-row">
            <div class="left">
              <div class="title">Browse Investment Opportunities</div>
              <div class="meta">View available projects and investment opportunities</div>
            </div>
            <a class="bf-btn primary" href="{{ url_for('opportunities') }}">Explore</a>
          </div>
          <div class="bf-row">
            <div class="left">
              <div class="title">Discover Producers</div>
              <div class="meta">Find talented producers to invest in or collaborate with</div>
            </div>
            <a class="bf-btn" href="{{ url_for('producer_catalog_index') }}">Browse</a>
          </div>
          <div class="bf-row">
            <div class="left">
              <div class="title">Find Service Providers</div>
              <div class="meta">Connect with studios, videographers, and creative professionals</div>
            </div>
            <a class="bf-btn" href="{{ url_for('bookme_search') }}">Search</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Recent Transactions -->
    <div class="bf-card span-6">
      <h3>Recent Transactions</h3>
      {% if txns and txns|length > 0 %}
        <div class="bf-list">
          {% for t in txns[:5] %}
            <div class="bf-row">
              <div class="left">
                <div class="title">{{ t.entry_type.value }}</div>
                <div class="meta">{{ t.created_at.strftime("%b %d, %Y") if t.created_at else '' }}</div>
                {% if t.meta %}<div class="meta" style="font-size:.85rem;">{{ t.meta[:60] }}{% if t.meta|length > 60 %}...{% endif %}</div>{% endif %}
              </div>
              <div class="bf-chip" style="{% if t.amount_cents and t.amount_cents > 0 %}background: rgba(34,197,94,.2); border-color: rgba(34,197,94,.4);{% else %}background: rgba(239,68,68,.2); border-color: rgba(239,68,68,.4);{% endif %}">
                ${{ '%.2f'|format((t.amount_cents or 0)/100) }}
              </div>
            </div>
          {% endfor %}
        </div>
        <div style="margin-top:12px;">
          <a class="bf-btn block" href="{{ url_for('wallet_home', tab='transactions') }}">View All Transactions</a>
        </div>
      {% else %}
        <p style="opacity:.75; margin:12px 0;">No transactions yet. Fund your wallet to get started.</p>
        <a class="bf-btn block primary" href="{{ url_for('wallet_home') }}">Fund Wallet</a>
      {% endif %}
    </div>

    <!-- Portfolio & Activity -->
    <div class="bf-card span-6">
      <h3>Portfolio & Activity</h3>
      <div style="padding: 12px 0;">
        <div style="margin-bottom: 16px;">
          <div style="font-size: 1.5rem; font-weight: 800; line-height: 1.2; margin-bottom: 4px;">
            {{ purchases_count }} beats
          </div>
          <div style="opacity: .7; font-size: .9rem;">In your portfolio</div>
        </div>
        <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 16px;">
          <a class="bf-btn" href="{{ url_for('market_my_purchases') }}">View Purchases</a>
          <a class="bf-btn" href="{{ url_for('market_index') }}">Browse More</a>
        </div>
        <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid rgba(255,255,255,.1);">
          <a class="bf-btn block" href="{{ url_for('my_tickets') }}">Support & Tickets</a>
        </div>
      </div>
    </div>

  </div>
</div>
{% endblock %}
