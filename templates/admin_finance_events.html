{% extends "base_admin.html" %}
{% block title %}BeatFund · Admin · Finance Events{% endblock %}

{% block admin_content %}
<div class="admin-page-header">
  <h1>Finance Events</h1>
  <p>Pre-filtered audit events for wallet/holds/withdrawals/refunds/webhooks.</p>
</div>

<div class="card">
  <h2>Recent</h2>
  <div class="card-subtitle">Showing up to 500 most recent finance events.</div>
  <div style="overflow:auto;">
    <table style="width:100%; border-collapse:collapse;">
      <thead>
        <tr>
          <th style="text-align:left; padding:8px; border-bottom:1px solid rgba(148,163,184,0.2);">Time (UTC)</th>
          <th style="text-align:left; padding:8px; border-bottom:1px solid rgba(148,163,184,0.2);">Type</th>
          <th style="text-align:left; padding:8px; border-bottom:1px solid rgba(148,163,184,0.2);">Actor</th>
          <th style="text-align:left; padding:8px; border-bottom:1px solid rgba(148,163,184,0.2);">Target</th>
          <th style="text-align:left; padding:8px; border-bottom:1px solid rgba(148,163,184,0.2);">Reason</th>
          <th style="text-align:left; padding:8px; border-bottom:1px solid rgba(148,163,184,0.2);">Detail</th>
        </tr>
      </thead>
      <tbody>
        {% for log in logs %}
        <tr style="border-top:1px solid rgba(148,163,184,0.10);">
          <td style="padding:8px; white-space:nowrap;">{{ log.created_at.strftime("%Y-%m-%d %H:%M:%S") if log.created_at else "-" }}</td>
          <td style="padding:8px;">{{ (log.action_type or log.action) }}</td>
          <td style="padding:8px;">
            {% if log.actor_user %}
              @{{ log.actor_user.username }}
            {% elif log.admin %}
              @{{ log.admin.username }}
            {% else %}
              system
            {% endif %}
          </td>
          <td style="padding:8px;">{{ log.target_type or "-" }}{% if log.target_id %} #{{ log.target_id }}{% endif %}</td>
          <td style="padding:8px; max-width:420px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ log.reason or "" }}</td>
          <td style="padding:8px;"><a href="{{ url_for('admin_audit_detail', log_id=log.id) }}">View</a></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <div style="margin-top:10px;">
    <a class="btn" href="{{ url_for('admin_audit', action_type='STRIPE_WEBHOOK_APPLIED') }}">Filter Stripe webhook events</a>
  </div>
</div>
{% endblock %}

