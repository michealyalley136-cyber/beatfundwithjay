{% extends "base.html" %}
{% block title %}My Beats · BeatFund{% endblock %}

{% block content %}
<div class="page">
  <div class="page-header">
    <h1>My Beats</h1>
    <p>Upload beats for the marketplace. Preview is what people play. Stems are the deliverable after purchase.</p>
  </div>

  <div class="card">
    <h2>Upload a Beat</h2>
    <form method="POST" enctype="multipart/form-data">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

      <div class="form-group">
        <label>Title *</label>
        <input class="form-control" name="title" required>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Price (USD)</label>
          <input class="form-control" name="price_dollars" placeholder="19.99">
        </div>

        <div class="form-group">
          <label>BPM</label>
          <input class="form-control" name="bpm" placeholder="130">
        </div>

        <div class="form-group">
          <label>Genre</label>
          <input class="form-control" name="genre" placeholder="Afrobeats / Trap / R&B...">
        </div>
      </div>

      <div class="form-group">
        <label>Cover Image (jpg/png)</label>
        <input class="form-control" type="file" name="cover_file" accept=".jpg,.jpeg,.png">
      </div>

      <div class="form-group">
        <label>Preview Audio (mp3/wav/m4a/ogg)</label>
        <input class="form-control" type="file" name="preview_file" accept=".mp3,.wav,.m4a,.ogg">
      </div>

      <div class="form-group">
        <label>Stems / Deliverable (zip/rar/7z or audio)</label>
        <input class="form-control" type="file" name="stems_file" accept=".zip,.rar,.7z,.mp3,.wav,.m4a,.ogg">
      </div>

      <button class="btn btn-primary" type="submit">Save Beat</button>
      <a class="btn btn-secondary" href="{{ url_for('market_index') }}">Go to Market</a>
    </form>
  </div>

  <div class="card">
    <h2>Your Uploaded Beats</h2>

    {% if beats %}
      <div class="grid">
        {% for b in beats %}
          <div class="beat-card">
            <div class="beat-cover">
              {% if b.cover_url %}
                <img src="{{ b.cover_url }}" alt="{{ b.title }}">
              {% else %}
                <div class="cover-placeholder">No Cover</div>
              {% endif %}
            </div>

            <div class="beat-meta">
              <div class="beat-title">{{ b.title }}</div>
              <div class="beat-sub">
                {% if b.genre %}{{ b.genre }} · {% endif %}
                {% if b.bpm %}{{ b.bpm }} BPM · {% endif %}
                ${{ "%.2f"|format((b.price_cents or 0)/100) }}
              </div>

              {% if b.preview_url %}
                <audio controls preload="none" style="width:100%;">
                  <source src="{{ b.preview_url }}">
                </audio>
              {% endif %}

              <form method="POST" action="{{ url_for('producer_beats_delete', beat_id=b.id) }}"
                    onsubmit="return confirm('Delete this beat?');">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button class="btn btn-danger" type="submit">Delete</button>
              </form>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p>No beats uploaded yet.</p>
    {% endif %}
  </div>
</div>
{% endblock %}
