{% extends "base.html" %} 

{% block title %}Admin Dashboard · BeatFund{% endblock %}

{% block extra_head %}
<style>
  .grid {
    display: grid;
    gap: 14px;
  }
  .grid-4 {
    grid-template-columns: repeat(4, minmax(0, 1fr));
  }
  .grid-2 {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }
  @media (max-width: 900px) {
    .grid-4, .grid-2 { grid-template-columns: 1fr; }
  }

  .card-admin {
    background: linear-gradient(135deg, #0b1220, #020617);
    border-radius: 16px;
    border: 1px solid #20263b;
    box-shadow: 0 18px 35px rgba(15, 23, 42, 0.9);
    padding: 16px 18px;
  }

  .card-title {
    font-size: 13px;
    text-transform: uppercase;
    letter-spacing: 0.14em;
    color: #9aa4c2;
    margin-bottom: 4px;
  }
  .card-value-lg {
    font-size: 22px;
    font-weight: 600;
  }
  .card-sub {
    font-size: 12px;
    color: #9aa4c2;
  }

  .pill-sm {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 2px 7px;
    border-radius: 999px;
    border: 1px solid rgba(148, 163, 184, 0.5);
    font-size: 11px;
    white-space: nowrap;
  }

  .link-inline {
    font-size: 12px;
    color: #38bdf8;
  }

  .list-simple {
    list-style: none;
    padding: 0;
    margin: 8px 0 0;
  }
  .list-simple li + li {
    margin-top: 6px;
    border-top: 1px solid rgba(15, 23, 42, 0.9);
    padding-top: 6px;
  }
  .muted {
    color: #9aa4c2;
    font-size: 12px;
  }

  .btn-ghost {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 6px 10px;
    border-radius: 999px;
    border: 1px solid #1f2937;
    font-size: 12px;
    color: #e5e7eb;
    background: rgba(15, 23, 42, 0.6);
    text-decoration: none;
  }
  .btn-ghost:hover {
    background: rgba(30, 64, 175, 0.6);
  }

  .ticket-count-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 12px;
    margin-top: 6px;
  }
  .ticket-count-label {
    color: #9aa4c2;
  }
  .ticket-count-value {
    font-weight: 500;
  }

  /* Small page header polish */
  .admin-header {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: flex-end;
    gap: 8px;
    margin-bottom: 18px;
  }
  .admin-header-title {
    font-size: 24px;
    font-weight: 600;
    margin-bottom: 2px;
  }
  .admin-header-subtitle {
    font-size: 13px;
    color: #9aa4c2;
  }
  .admin-header-subtitle span {
    font-weight: 500;
    color: #e5e7eb;
  }
  .admin-header-meta {
    font-size: 12px;
    color: #9aa4c2;
    padding: 4px 10px;
    border-radius: 999px;
    border: 1px solid #1f2937;
    background: rgba(15, 23, 42, 0.6);
    white-space: nowrap;
  }
</style>
{% endblock %}

{% block content %}
<div class="admin-header">
  <div>
    <div class="admin-header-title">Admin Dashboard</div>
    <div class="admin-header-subtitle">
      BeatFund · <span>Fine-tech for creatives</span>
    </div>
  </div>
  <div class="admin-header-meta">
    Logged in as <strong>@{{ current_user.username }}</strong>
  </div>
</div>

<p style="font-size:13px; color:#9aa4c2; margin-bottom:18px;">
  High-level view of customers, wallets, tickets, and recent admin activity.
</p>

<!-- Top stats -->
<div class="grid grid-4" style="margin-bottom:14px;">
  <div class="card-admin">
    <div class="card-title">Users</div>
    <div class="card-value-lg">{{ total_users }}</div>
    <div class="card-sub">Non-admin accounts</div>
  </div>
  <div class="card-admin">
    <div class="card-title">Wallets</div>
    <div class="card-value-lg">{{ total_wallets }}</div>
    <div class="card-sub">Customer wallets created</div>
  </div>
  <div class="card-admin">
    <div class="card-title">Beats</div>
    <div class="card-value-lg">{{ total_beats }}</div>
    <div class="card-sub">Active marketplace beats</div>
  </div>
  <div class="card-admin">
    <div class="card-title">Orders</div>
    <div class="card-value-lg">{{ total_orders }}</div>
    <div class="card-sub">Completed purchases</div>
  </div>
</div>

<!-- Middle row: users/KYC + tickets overview -->
<div class="grid grid-2" style="margin-bottom:14px;">
  <!-- Users & KYC -->
  <div class="card-admin">
    <div class="card-title">User Overview</div>
    <div class="card-sub" style="margin-bottom:10px;">
      Artists: <strong>{{ total_artists }}</strong> · Producers: <strong>{{ total_producers }}</strong>
      <span style="margin-left:8px;">
        <a href="{{ url_for('admin_users') }}" class="link-inline">View all users →</a>
      </span>
    </div>

    <div class="card-title" style="margin-top:10px;">KYC Status</div>
    <ul class="list-simple">
      <li>
        Pending
        <span class="pill-sm" style="margin-left:8px;">{{ pending_kyc }}</span>
      </li>
      <li>
        Approved
        <span class="pill-sm" style="margin-left:8px;">{{ approved_kyc }}</span>
      </li>
      <li>
        Rejected
        <span class="pill-sm" style="margin-left:8px;">{{ rejected_kyc }}</span>
      </li>
    </ul>
    <div style="margin-top:8px;">
      <a href="{{ url_for('admin_kyc') }}" class="link-inline">Review KYC queue →</a>
    </div>
  </div>

  <!-- Tickets overview -->
  <div class="card-admin">
    <div class="card-title">Support Tickets</div>
    <div class="card-value-lg">{{ total_tickets }}</div>
    <div class="card-sub">Total tickets logged</div>

    <div class="ticket-count-row" style="margin-top:10px;">
      <div class="ticket-count-label">Open</div>
      <div class="ticket-count-value">{{ open_tickets }}</div>
    </div>
    <div class="ticket-count-row">
      <div class="ticket-count-label">In review</div>
      <div class="ticket-count-value">{{ in_review_tickets }}</div>
    </div>
    <div class="ticket-count-row">
      <div class="ticket-count-label">Resolved / closed</div>
      <div class="ticket-count-value">{{ resolved_tickets }}</div>
    </div>

    <div style="margin-top:10px;">
      <a href="{{ url_for('admin_tickets') }}" class="btn-ghost">Go to Tickets hub</a>
    </div>
  </div>
</div>

<!-- Bottom row: quick actions + recent activity -->
<div class="grid grid-2">
  <!-- Quick admin actions -->
  <div class="card-admin">
    <div class="card-title">Quick Admin Actions</div>
    <div class="grid grid-2" style="margin-top:8px; gap:10px;">
      <a href="{{ url_for('admin_users') }}" class="btn-ghost">Users &amp; KYC</a>
      <a href="{{ url_for('admin_kyc') }}" class="btn-ghost">KYC Queue</a>
      <a href="{{ url_for('admin_transactions') }}" class="btn-ghost">Transactions</a>
      <a href="{{ url_for('admin_reports') }}" class="btn-ghost">Reports</a>
      <a href="{{ url_for('admin_tickets') }}" class="btn-ghost">Tickets</a>
    </div>
  </div>

  <!-- Recent activity -->
  <div class="card-admin">
    <div class="card-title">Recent Activity</div>
    {% if recent_events %}
      <ul class="list-simple">
        {% for e in recent_events %}
          <li>
            <div style="font-size:12px;">
              {{ e.title }}
            </div>
            <div class="muted">
              {{ e.body }} · {{ e.ts.strftime('%Y-%m-%d %H:%M') }}
            </div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="muted" style="margin-top:6px;">
        No activity data yet. This will fill up as admins access wallets and create tickets.
      </p>
    {% endif %}
  </div>
</div>
{% endblock %}
