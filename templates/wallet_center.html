{% extends "base.html" %}
{% block title %}Wallet Â· BeatFund{% endblock %}

{% block content %}
<div class="page">

  <div class="page-header">
    <div>
      <h1 style="margin:0;">Wallet</h1>
      <div class="muted">Balance + transaction history</div>
    </div>
  </div>

  <div class="card" style="margin-top:14px;">
    <div class="muted">Current balance</div>
    <div style="font-size:32px; font-weight:800;">${{ "%.2f"|format(balance) }}</div>
  </div>

  <div style="display:flex; gap:10px; margin-top:14px; flex-wrap:wrap;">
    <a class="btn {% if tab == 'overview' %}btn-primary{% else %}btn-outline{% endif %}"
       href="{{ url_for('wallet_home', tab='overview') }}">
      Overview
    </a>
    <a class="btn {% if tab == 'transactions' %}btn-primary{% else %}btn-outline{% endif %}"
       href="{{ url_for('wallet_home', tab='transactions') }}">
      Transactions
    </a>

    <a class="btn btn-outline" href="{{ url_for('wallet_statement') }}">Download statement (CSV)</a>
  </div>

  {% set credit_types = [
    EntryType.deposit,
    EntryType.transfer_in,
    EntryType.interest,
    EntryType.adjustment,
    EntryType.sale_income
  ] %}

  <div class="card" style="margin-top:14px;">
    <h3 style="margin:0 0 10px 0;">Transaction History</h3>

    <div style="overflow:auto;">
      <table class="table" style="min-width:760px; width:100%;">
        <thead>
          <tr>
            <th>Date</th>
            <th>Type</th>
            <th>Note</th>
            <th style="text-align:right;">Amount</th>
          </tr>
        </thead>
        <tbody>
          {% if txns and txns|length > 0 %}
            {% for t in txns %}
              {% set is_credit = (t.entry_type in credit_types) %}
              {% set amt = (t.amount_cents or 0) / 100.0 %}
              <tr>
                <td>{{ t.created_at.strftime("%b %d, %Y %I:%M %p") if t.created_at else "-" }}</td>
                <td>{{ t.entry_type.value.replace("_"," ").title() }}</td>
                <td>{{ t.meta or "-" }}</td>
                <td style="text-align:right; font-weight:700;">
                  {% if is_credit %}
                    +${{ "%.2f"|format(amt) }}
                  {% else %}
                    -${{ "%.2f"|format(amt) }}
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          {% else %}
            <tr><td colspan="4" class="muted" style="padding:14px;">No transactions yet.</td></tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>

  {% if tab == 'overview' %}
  <div class="card" style="margin-top:14px;">
    <h3 style="margin:0 0 8px 0;">Quick Actions</h3>
    <div class="muted">Use the existing wallet actions form on your wallet page (or keep it where it already is).</div>
  </div>
  {% endif %}

</div>
{% endblock %}
