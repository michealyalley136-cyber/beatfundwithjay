{% extends "base.html" %}
{% block title %}Provider Dashboard · BeatFund{% endblock %}

{% block extra_head %}
<style>
  .dash-page {
    max-width: 1120px;
    margin: 32px auto 48px;
    padding-inline: 16px;
    color: #e5e7eb;
  }

  .dash-kicker {
    font-size: 11px;
    letter-spacing: 0.16em;
    text-transform: uppercase;
    color: #a5b4fc;
    margin-bottom: 4px;
  }

  .dash-title {
    font-size: 26px;
    font-weight: 650;
    letter-spacing: 0.02em;
    margin-bottom: 4px;
  }

  .dash-subtitle {
    font-size: 13px;
    color: #9ca3c8;
    margin-bottom: 20px;
  }

  .dash-layout {
    display: grid;
    grid-template-columns: minmax(0, 1.3fr) minmax(0, 1fr);
    gap: 20px;
  }

  @media (max-width: 900px) {
    .dash-layout {
      grid-template-columns: minmax(0, 1fr);
    }
  }

  .dash-card {
    border-radius: 20px;
    border: 1px solid rgba(30, 64, 175, 0.9);
    background:
      radial-gradient(circle at top left, rgba(56, 189, 248, 0.16), transparent 55%),
      radial-gradient(circle at bottom right, rgba(129, 140, 248, 0.22), transparent 55%),
      rgba(15, 23, 42, 0.96);
    box-shadow:
      0 22px 45px rgba(15, 23, 42, 0.9),
      0 0 0 1px rgba(15, 23, 42, 1) inset;
    padding: 18px 18px 20px;
    position: relative;
    overflow: hidden;
  }

  .dash-card::before {
    content: "";
    position: absolute;
    inset: -40%;
    background:
      radial-gradient(circle at 0% 0%, rgba(59, 130, 246, 0.35), transparent 60%),
      radial-gradient(circle at 100% 100%, rgba(45, 212, 191, 0.35), transparent 60%);
    opacity: 0.35;
    pointer-events: none;
  }

  .dash-card-inner {
    position: relative;
    z-index: 1;
  }

  .dash-card-title {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 6px;
  }

  .dash-card-sub {
    font-size: 12px;
    color: #9aa4c2;
    margin-bottom: 12px;
  }

  .provider-hero {
    display: grid;
    grid-template-columns: auto minmax(0, 1fr);
    gap: 14px;
    align-items: center;
    margin-bottom: 16px;
  }

  .provider-avatar {
    width: 60px;
    height: 60px;
    border-radius: 999px;
    background: linear-gradient(135deg, #38bdf8, #6366f1);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 26px;
    font-weight: 700;
    color: #0b1120;
    overflow: hidden;
  }

  .provider-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .provider-meta-line {
    font-size: 12px;
    color: #9ca3c8;
  }

  .provider-name {
    font-size: 16px;
    font-weight: 600;
  }

  .provider-tag {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 3px 9px;
    border-radius: 999px;
    font-size: 11px;
    background: rgba(15, 23, 42, 0.95);
    border: 1px solid rgba(129, 140, 248, 0.65);
    color: #c7d2fe;
    margin-top: 4px;
  }

  .provider-tag-dot {
    width: 6px;
    height: 6px;
    border-radius: 999px;
    background: #22c55e;
  }

  .stats-row {
    display: grid;
    grid-template-columns: repeat(4, minmax(0, 1fr));
    gap: 10px;
    margin-bottom: 14px;
  }

  @media (max-width: 700px) {
    .stats-row {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }
  }

  .stat-pill {
    border-radius: 14px;
    background: radial-gradient(circle at top, rgba(15, 23, 42, 0.95), rgba(15, 23, 42, 1));
    border: 1px solid rgba(31, 41, 55, 0.9);
    padding: 7px 9px;
  }

  .stat-label {
    font-size: 10px;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: #9ca3c8;
    margin-bottom: 2px;
  }

  .stat-value {
    font-size: 16px;
    font-weight: 600;
  }

  .stat-caption {
    font-size: 11px;
    color: #9ca3c8;
  }

  .pill-row {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-bottom: 4px;
  }

  .pill-link {
    border-radius: 999px;
    padding: 5px 11px;
    font-size: 11px;
    border: 1px solid rgba(55, 65, 81, 0.9);
    background: rgba(15, 23, 42, 0.96);
    color: #e5e7eb;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 4px;
  }

  .pill-link-primary {
    border-color: rgba(56, 189, 248, 0.9);
    background: linear-gradient(135deg, #22d3ee, #6366f1);
    color: #0b1120;
  }

  .pill-link-primary span.icon {
    font-size: 13px;
  }

  .actions-grid {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 10px;
    margin-top: 6px;
  }

  @media (max-width: 700px) {
    .actions-grid {
      grid-template-columns: minmax(0, 1fr);
    }
  }

  .action-card {
    border-radius: 14px;
    border: 1px solid rgba(31, 41, 55, 0.9);
    background: radial-gradient(circle at top, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 1));
    padding: 9px 10px 10px;
  }

  .action-title {
    font-size: 12px;
    font-weight: 600;
    margin-bottom: 3px;
  }

  .action-body {
    font-size: 11px;
    color: #9ca3c8;
    margin-bottom: 6px;
  }

  .action-footer {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
  }

  .btn-mini {
    border-radius: 999px;
    padding: 4px 9px;
    font-size: 11px;
    border: 1px solid rgba(55, 65, 81, 0.9);
    background: rgba(15, 23, 42, 0.98);
    color: #e5e7eb;
    text-decoration: none;
  }

  .btn-mini-primary {
    border-color: rgba(56, 189, 248, 0.9);
    background: linear-gradient(135deg, #22d3ee, #6366f1);
    color: #0b1120;
  }

  .status-tag {
    display: inline-flex;
    align-items: center;
    padding: 2px 8px;
    border-radius: 999px;
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    background: rgba(22, 163, 74, 0.12);
    color: #bbf7d0;
    border: 1px solid rgba(22, 163, 74, 0.6);
  }

  .status-tag-warn {
    background: rgba(234, 179, 8, 0.12);
    border-color: rgba(234, 179, 8, 0.6);
    color: #fef9c3;
  }

  .list-item {
    border-radius: 12px;
    border: 1px solid rgba(31, 41, 55, 0.9);
    background: rgba(15, 23, 42, 0.98);
    padding: 8px 10px;
    font-size: 12px;
    margin-bottom: 6px;
  }

  .list-item-label {
    color: #9ca3c8;
    font-size: 11px;
    margin-bottom: 2px;
  }

  .list-item-main {
    display: flex;
    justify-content: space-between;
    gap: 8px;
  }

  .list-item-main span.value {
    font-weight: 500;
  }

</style>
{% endblock %}

{% block content %}
<div class="dash-page">

  <div class="dash-kicker">Service provider</div>
  <h1 class="dash-title">BeatFund {{ role_label }}</h1>
  <p class="dash-subtitle">
    Welcome back, @{{ current_user.username }}. This is your provider workspace for managing your services,
    bookings, and visibility on BeatFund.
  </p>

  <div class="dash-layout">
    <!-- Left: profile + stats + actions -->
    <section class="dash-card">
      <div class="dash-card-inner">

        <!-- Provider hero -->
        <div class="provider-hero">
          <div class="provider-avatar">
            {% if current_user.avatar_url %}
              <img src="{{ current_user.avatar_url }}" alt="Avatar">
            {% else %}
              {{ current_user.username[:1].upper() }}
            {% endif %}
          </div>
          <div>
            <div class="provider-meta-line">Service Provider</div>
            <div class="provider-name">
              {{ current_user.full_name or current_user.artist_name or current_user.username }}
            </div>
            <div class="provider-tag">
              <span class="provider-tag-dot"></span>
              <span>Your primary role:</span>
              <strong>{{ role_label }}</strong>
            </div>
          </div>
        </div>

        <!-- Stats -->
        <div class="stats-row">
          <div class="stat-pill">
            <div class="stat-label">Followers</div>
            <div class="stat-value">{{ followers_count }}</div>
            <div class="stat-caption">People tracking your work</div>
          </div>
          <div class="stat-pill">
            <div class="stat-label">Incoming requests</div>
            <div class="stat-value">{{ incoming_requests }}</div>
            <div class="stat-caption">New booking requests</div>
          </div>
          <div class="stat-pill">
            <div class="stat-label">Outgoing requests</div>
            <div class="stat-value">{{ outgoing_requests }}</div>
            <div class="stat-caption">Requests you’ve sent</div>
          </div>
          <div class="stat-pill">
            <div class="stat-label">Bookings</div>
            <div class="stat-value">{{ incoming_bookings_count }}</div>
            <div class="stat-caption">Events you’re booked on</div>
          </div>
        </div>

        <!-- Key links -->
        <div class="pill-row">
          <a href="{{ url_for('bookme_profile') }}" class="pill-link-primary pill-link">
            <span class="icon">⚙️</span>
            <span>Edit provider profile</span>
          </a>

          <a href="{{ url_for('bookme_requests') }}" class="pill-link">
            BookMe requests
          </a>

          <a href="{{ url_for('wallet_home') }}" class="pill-link">
            Wallet &amp; transactions
          </a>

          <a href="{{ url_for('bookme_search') }}" class="pill-link">
            BookMe directory
          </a>
        </div>

        <!-- Actions grid -->
        <div class="actions-grid">
          <div class="action-card">
            <div class="action-title">Provider profile</div>
            <div class="action-body">
              {% if portfolio_count > 0 %}
                Your profile is live in the BookMe directory. Keep your services, pricing,
                and city/location up to date so the right clients find you.
              {% else %}
                Create a clear profile with services, example projects, and a short bio so
                promoters know exactly what you offer.
              {% endif %}
            </div>
            <div class="action-footer">
              <a href="{{ url_for('bookme_profile') }}" class="btn-mini-primary btn-mini">
                Open profile settings
              </a>
              {% if requires_portfolio %}
                <a href="{{ url_for('bookme_portfolio') }}" class="btn-mini">
                  Manage portfolio ({{ portfolio_count }}/{{ MAX_PORTFOLIO_ITEMS }})
                </a>
              {% endif %}
            </div>
          </div>

          <div class="action-card">
            <div class="action-title">Bookings &amp; requests</div>
            <div class="action-body">
              Respond quickly to new requests to secure the gig. You can view your upcoming
              confirmed bookings and client history from one place.
            </div>
            <div class="action-footer">
              <a href="{{ url_for('bookme_requests') }}" class="btn-mini-primary btn-mini">
                View booking requests
              </a>
              <a href="{{ url_for('wallet_home') }}" class="btn-mini">
                Add funds / view wallet
              </a>
            </div>
          </div>
        </div>

      </div>
    </section>

    <!-- Right: booking snapshot / status -->
    <section class="dash-card">
      <div class="dash-card-inner">
        <div class="dash-card-title">Bookings &amp; activity</div>
        <p class="dash-card-sub">
          Quick snapshot of your BookMe activity. Use the booking requests page for full details.
        </p>

        <div class="list-item">
          <div class="list-item-label">Bookings overview</div>
          <div class="list-item-main">
            <div>
              <span class="value">{{ incoming_bookings_count }}</span> as provider<br>
              <span style="font-size:11px; color:#9ca3c8;">
                {{ outgoing_bookings_count }} as client (when you book others)
              </span>
            </div>
            <span class="status-tag">
              On-platform
            </span>
          </div>
        </div>

        <div class="list-item">
          <div class="list-item-label">New requests</div>
          <div class="list-item-main">
            <span class="value">{{ incoming_requests }}</span>
            {% if incoming_requests > 0 %}
              <span class="status-tag-warn">Action needed</span>
            {% else %}
              <span class="status-tag">All caught up</span>
            {% endif %}
          </div>
        </div>

        {% if requires_portfolio %}
          <div class="list-item">
            <div class="list-item-label">Portfolio status</div>
            <div class="list-item-main">
              <span class="value">
                {{ portfolio_count }} item{{ portfolio_count != 1 and 's' or '' }}
              </span>
              {% if portfolio_count == 0 %}
                <span class="status-tag-warn">Add examples</span>
              {% else %}
                <span class="status-tag">Visible in directory</span>
              {% endif %}
            </div>
          </div>
        {% endif %}

        <p style="font-size:11px; color:#9ca3c8; margin-top:10px;">
          Tip: Share your public booking link with promoters and event organizers so they can
          request you directly.
        </p>
      </div>
    </section>
  </div>
</div>
{% endblock %}
