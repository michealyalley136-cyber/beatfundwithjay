{% extends "base.html" %}
{% block title %}Edit Profile · BeatFund{% endblock %}

{% block extra_head %}
<style>
  /* ================================
     BeatFund · Profile Edit (scoped)
     ================================ */
  .bf-profile {
    max-width: 1100px;
    margin: 0 auto;
    padding: 20px;
  }

  .bf-card {
    background: rgba(255,255,255,.06);
    border: 1px solid rgba(255,255,255,.12);
    border-radius: 18px;
    padding: 18px;
    box-shadow: 0 10px 30px rgba(0,0,0,.25);
    backdrop-filter: blur(10px);
  }

  .bf-head {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 12px;
    flex-wrap: wrap;
    margin-bottom: 14px;
  }

  .bf-title h1 {
    margin: 0;
    font-size: 1.5rem;
    line-height: 1.15;
    letter-spacing: .2px;
  }

  .bf-title p {
    margin: 6px 0 0;
    opacity: .8;
  }

  .bf-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }

  .bf-grid {
    display: grid;
    grid-template-columns: 320px 1fr;
    gap: 16px;
    align-items: start;
  }

  @media (max-width: 920px) {
    .bf-grid { grid-template-columns: 1fr; }
    .bf-profile { padding: 14px; }
  }

  .bf-side {
    position: sticky;
    top: 12px;
  }
  @media (max-width: 920px) {
    .bf-side { position: static; }
  }

  .bf-avatar-card {
    padding: 14px;
    border-radius: 16px;
    border: 1px solid rgba(255,255,255,.12);
    background: rgba(0,0,0,.18);
  }

  .bf-avatar {
    width: 140px;
    height: 140px;
    border-radius: 18px;
    object-fit: cover;
    display: block;
    border: 1px solid rgba(255,255,255,.12);
    box-shadow: 0 12px 30px rgba(0,0,0,.35);
  }

  .bf-muted {
    opacity: .78;
    font-size: .95rem;
  }

  .bf-stack { display: grid; gap: 10px; }

  .bf-form-card {
    padding: 14px;
    border-radius: 16px;
    border: 1px solid rgba(255,255,255,.12);
    background: rgba(0,0,0,.12);
  }

  .bf-form-grid {
    display: grid;
    grid-template-columns: repeat(2, minmax(0,1fr));
    gap: 12px;
  }
  @media (max-width: 700px) {
    .bf-form-grid { grid-template-columns: 1fr; }
  }

  .bf-group label {
    display: block;
    font-weight: 600;
    margin-bottom: 6px;
    opacity: .9;
  }

  /* Inputs (scoped so we don’t break your global styles) */
  .bf-profile .form-control,
  .bf-profile input[type="text"],
  .bf-profile input[type="url"],
  .bf-profile input[type="tel"],
  .bf-profile textarea,
  .bf-profile select {
    width: 100%;
    padding: 10px 12px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.25);
    color: rgba(255,255,255,.92);
    outline: none;
  }

  .bf-profile textarea { resize: vertical; min-height: 110px; }

  .bf-divider {
    height: 1px;
    background: rgba(255,255,255,.10);
    margin: 14px 0;
  }

  .bf-footer-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    flex-wrap: wrap;
    margin-top: 12px;
  }

  .bf-kicker {
    display: inline-flex;
    gap: 8px;
    align-items: center;
    padding: 8px 10px;
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,.12);
    background: rgba(0,0,0,.18);
    font-size: .9rem;
  }
</style>
{% endblock %}

{% block content %}
<div class="bf-profile">
  <div class="bf-card">

    <div class="bf-head">
      <div class="bf-title">
        <h1>Edit Profile</h1>
        <p class="bf-muted">Update your public info, contact details, and avatar.</p>
      </div>

      <div class="bf-actions">
        <a class="btn btn-secondary" href="{{ url_for('route_to_dashboard') }}">Back to dashboard</a>
      </div>
    </div>

    {# Optional KYC badge (safe) #}
    <div class="bf-kicker" style="margin-bottom:14px;">
      <strong>KYC:</strong>
      <span class="bf-muted">
        {{ current_user.kyc_status.value.replace('_',' ').title() if current_user.kyc_status is defined else 'Unknown' }}
      </span>
    </div>

    <div class="bf-grid">

      <!-- LEFT: Avatar -->
      <div class="bf-side">
        <div class="bf-avatar-card bf-stack">
          <img class="bf-avatar" src="{{ current_user.avatar_url }}" alt="avatar">
          <div class="bf-muted">Recommended: square image, 600×600+</div>

          <form method="post" action="{{ url_for('update_avatar') }}" enctype="multipart/form-data" class="bf-stack">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input class="form-control" type="file" name="avatar" accept="image/*" required>
            <button class="btn btn-primary" type="submit">Upload new avatar</button>
          </form>
        </div>
      </div>

      <!-- RIGHT: Profile fields -->
      <div class="bf-form-card">
        <form method="post" action="{{ url_for('profile_edit') }}" class="bf-stack">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

          <div class="bf-form-grid">
            <div class="bf-group">
              <label>Display name</label>
              <input class="form-control" name="display_name"
                     value="{{ (prof.display_name if prof else current_user.display_name) | default('', true) }}"
                     placeholder="e.g., Artist Name">
            </div>

            <div class="bf-group">
              <label>Phone number</label>
              <input class="form-control" name="phone"
                     value="{{ (prof.contact_phone if prof else '') | default('', true) }}"
                     placeholder="e.g., +1 (865) 555-1234">
            </div>

            <div class="bf-group">
              <label>City</label>
              <input class="form-control" name="city"
                     value="{{ (prof.city if prof else '') | default('', true) }}"
                     placeholder="e.g., Sevierville">
            </div>

            <div class="bf-group">
              <label>State</label>
              <input class="form-control" name="state"
                     value="{{ (prof.state if prof else '') | default('', true) }}"
                     placeholder="e.g., TN">
            </div>
          </div>

          <div class="bf-group">
            <label>Bio</label>
            <textarea class="form-control" name="bio" rows="6"
              placeholder="Tell promoters and collaborators what you do...">{{ (prof.bio if prof else '') | default('', true) }}</textarea>
          </div>

          <div class="bf-divider"></div>

          <div class="bf-footer-actions">
            <a class="btn btn-secondary" href="{{ url_for('route_to_dashboard') }}">Cancel</a>
            <button class="btn btn-primary" type="submit">Save changes</button>
          </div>

          <div class="bf-muted" style="margin-top:8px;">
            Tip: Keep your phone + city updated so bookings go smoother.
          </div>
        </form>
      </div>

    </div>
  </div>
</div>
{% endblock %}
