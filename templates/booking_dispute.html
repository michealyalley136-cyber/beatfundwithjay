{% extends "base.html" %}
{% block title %}Booking Dispute - BeatFund{% endblock %}

{% block content %}
<div class="page" style="max-width:860px;margin:0 auto;padding:24px 16px;">
  <div class="card">
    <h2 style="margin-top:0;">Booking Dispute - #{{ booking.id }}</h2>

    {% if dispute %}
      <p class="muted">Status: {{ dispute.status|replace("_"," ")|title }}</p>
      <p><strong>Reason:</strong> {{ dispute.reason }}</p>
    {% else %}
      <p class="muted">Open a dispute for this booking. One dispute per booking.</p>
      <form method="POST" action="{{ url_for('booking_dispute', booking_id=booking.id) }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <label style="display:block;font-weight:600;">Reason</label>
        <input type="text" name="reason" required maxlength="300"
               style="width:100%;padding:10px;border-radius:8px;border:1px solid #ddd;">
        <label style="display:block;font-weight:600;margin-top:10px;">Details (optional)</label>
        <textarea name="details" rows="5" maxlength="2000"
                  style="width:100%;padding:10px;border-radius:8px;border:1px solid #ddd;"></textarea>
        <div style="margin-top:12px;">
          <button type="submit" class="btn btn-primary">Open dispute</button>
          <a href="{{ url_for('booking_detail', booking_id=booking.id) }}" class="btn btn-secondary">Back</a>
        </div>
      </form>
    {% endif %}
  </div>

  {% if dispute %}
    <div class="card" style="margin-top:16px;">
      <h3 style="margin-top:0;">Thread</h3>
      {% if messages %}
        {% for m in messages %}
          <div style="border-top:1px solid #eee;padding-top:8px;margin-top:8px;">
            <div style="font-size:12px;color:#6b7280;">
              @{{ m.author.username }} - {{ m.created_at.strftime('%Y-%m-%d %H:%M') }}
            </div>
            <div style="margin-top:4px;white-space:pre-line;">{{ m.body }}</div>
          </div>
        {% endfor %}
      {% else %}
        <p class="muted">No messages yet.</p>
      {% endif %}

      <form method="POST" action="{{ url_for('dispute_reply', dispute_id=dispute.id) }}" style="margin-top:12px;">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <textarea name="body" rows="4" maxlength="2000"
                  style="width:100%;padding:10px;border-radius:8px;border:1px solid #ddd;"></textarea>
        <div style="margin-top:8px;">
          <button type="submit" class="btn btn-secondary">Send reply</button>
        </div>
      </form>
    </div>
  {% endif %}
</div>
{% endblock %}
